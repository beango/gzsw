@using gzsw.web
@model gzsw.controller.CHK.CounterModel
@{
    ViewBag.Title = "增加窗口值班";
    Layout = "~/Views/Shared/_MainLayout.cshtml";
}
@{
    var selectStaff = new List<SelectListItem>()
                      {
                          new SelectListItem()
                          {
                              Text="公假",
                              Value = "-1",
                              Selected=true
                          }
                      };
}

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
        @Html.ValidationSummary(true)
    <table class="formTable" cellpadding="0" cellspacing="0">
        <tr>
            <td class="tdLeft">服务厅：</td>
            <td>
                @Html.DropDownListFor(m => m.HallNo, ViewBag.Orgs as SelectList, "-- 请选择 --")
            </td>
            <td>
                @Html.ValidationMessageFor(m => m.HallNo)
            </td>
        </tr>
        <tr>
            <td class="tdLeft">窗口：</td>
            <td>
                @Html.DropDownListFor(m => m.CounterId, new List<SelectListItem>(), "请选择窗口", new { @class = "text-box", @style = "width:132px;" })
            </td>
            <td>
                @Html.ValidationMessageFor(m => m.CounterId)
            </td>
        </tr>
        <tr>
            <td class="tdLeft">备注：</td>
            <td>
                @Html.TextAreaFor(m => m.Note, new { @class = "text-box", @style = "width:250px;" })
            </td>
            <td>
                @Html.ValidationMessageFor(m => m.Note)
            </td>
        </tr>

    </table>
    <div class="tablePanel" style="margin:10px 20px 10px 20px;">
        <table class="tableform">
            <thead>
                <tr>
                    <th colspan="5">
                        员工排班
                    </th>
                </tr>
            </thead>
            <tr>
                <td>周一 </td>
                <td class="tdLeft pdRight">上午:</td>
                <td>
                    @Html.HiddenFor(m=>m.W1A_STAFF_ID)
                    @Html.DropDownList("W1A_STAFF_NAME", selectStaff, new { @hidId = "W1A_STAFF_ID", @dType = "select", @class = "text-box", @style = "width:100px;" })
                </td>
                <td class="tdLeft pdRight">
                    下午:
                </td>
                <td>
                    @Html.HiddenFor(m => m.W1P_STAFF_ID)
                    @Html.DropDownList("W1P_STAFF_NAME", selectStaff, new { @hidId = "W1P_STAFF_ID", @dType = "select", @class = "text-box", @style = "width:100px;" })
                </td>
            </tr>
            <tr>
                <td>周二 </td>
                <td class="tdLeft pdRight">上午:</td>
                <td>
                    @Html.HiddenFor(m => m.W2A_STAFF_ID)
                    @Html.DropDownList("W2A_STAFF_NAME", selectStaff, new { @hidId = "W2A_STAFF_ID", @dType = "select", @class = "text-box", @style = "width:100px;" })
                </td>
                <td class="tdLeft pdRight">
                    下午:
                </td>
                <td>
                    @Html.HiddenFor(m => m.W2P_STAFF_ID)
                    @Html.DropDownList("W2P_STAFF_NAME", selectStaff, new { @hidId = "W2P_STAFF_ID", @dType = "select", @class = "text-box", @style = "width:100px;" })
                </td>
            </tr>
            <tr>
                <td>周三 </td>
                <td class="tdLeft pdRight">上午:</td>
                <td>
                    @Html.HiddenFor(m => m.W3A_STAFF_ID)
                    @Html.DropDownList("W3A_STAFF_NAME", selectStaff, new { @hidId = "W3A_STAFF_ID", @dType = "select", @class = "text-box", @style = "width:100px;" })
                </td>
                <td class="tdLeft pdRight">
                    下午:
                </td>
                <td>
                    @Html.HiddenFor(m => m.W3P_STAFF_ID)
                    @Html.DropDownList("W3P_STAFF_NAME", selectStaff, new { @hidId = "W3P_STAFF_ID", @dType = "select", @class = "text-box", @style = "width:100px;" })
                </td>
            </tr>
            <tr>
                <td>周四 </td>
                <td class="tdLeft pdRight">上午:</td>
                <td>
                    @Html.HiddenFor(m => m.W4A_STAFF_ID)
                    @Html.DropDownList("W4A_STAFF_NAME", selectStaff, new { @hidId = "W4A_STAFF_ID", @dType = "select", @class = "text-box", @style = "width:100px;" })
                </td>
                <td class="tdLeft pdRight">
                    下午:
                </td>
                <td>
                    @Html.HiddenFor(m => m.W4P_STAFF_ID)
                    @Html.DropDownList("W4P_STAFF_NAME", selectStaff, new { @hidId = "W4P_STAFF_ID", @dType = "select", @class = "text-box", @style = "width:100px;" })
                </td>
            </tr>
            <tr>
                <td>周五 </td>
                <td class="tdLeft pdRight">上午:</td>
                <td>
                    @Html.HiddenFor(m => m.W5A_STAFF_ID)
                    @Html.DropDownList("W5A_STAFF_NAME", selectStaff, new { @hidId = "W5A_STAFF_ID", @dType = "select", @class = "text-box", @style = "width:100px;" })
                </td>
                <td class="tdLeft pdRight">
                    下午:
                </td>
                <td>
                    @Html.HiddenFor(m => m.W5P_STAFF_ID)
                    @Html.DropDownList("W5P_STAFF_NAME", selectStaff, new { @hidId = "W5P_STAFF_ID", @dType = "select", @class = "text-box", @style = "width:100px;" })
                </td>
            </tr>
            <tr>
                <td>周六 </td>
                <td class="tdLeft pdRight">上午:</td>
                <td>
                    @Html.HiddenFor(m => m.W6A_STAFF_ID)
                    @Html.DropDownList("W6A_STAFF_NAME", selectStaff, new { @hidId = "W6A_STAFF_ID", @dType = "select", @class = "text-box", @style = "width:100px;" })
                </td>
                <td class="tdLeft pdRight">
                    下午:
                </td>
                <td>
                    @Html.HiddenFor(m => m.W6P_STAFF_ID)
                    @Html.DropDownList("W6P_STAFF_NAME", selectStaff, new { @hidId = "W6P_STAFF_ID", @dType = "select", @class = "text-box", @style = "width:100px;" })
                </td>
            </tr>
            <tr>
                <td>周日 </td>
                <td class="tdLeft pdRight">上午:</td>
                <td>
                    @Html.HiddenFor(m => m.W7A_STAFF_ID)
                    @Html.DropDownList("W7A_STAFF_NAME", selectStaff, new { @hidId = "W7A_STAFF_ID", @dType = "select", @class = "text-box", @style = "width:100px;" })
                </td>
                <td class="tdLeft pdRight">
                    下午:
                </td>
                <td>
                    @Html.HiddenFor(m => m.W7P_STAFF_ID)
                    @Html.DropDownList("W7P_STAFF_NAME", selectStaff, new { @hidId = "W7P_STAFF_ID", @dType = "select", @class = "text-box", @style = "width:100px;" })
                </td>
            </tr>
        </table>
        <div style="text-align: center;margin-top: 20px;">
            <input type="submit" class="l-button" value="提交" />
        </div>
    </div>
}
@section Head{
    @Html.JavaScript("lib/jqueryform/jquery.form.js")
    @Html.JavaScript("lib/jquery.validate/jquery.validate.min.js")
    @Html.JavaScript("lib/jquery.validate/jquery.validate.unobtrusive.min.js")
    @Html.StyleSheet("lib/ztree/zTreeStyle.css")
    @Html.JavaScript("lib/ztree/jquery.ztree.core-3.5.min.js")
    @Html.JavaScript("lib/ztree/jquery.ztree.excheck-3.5.min.js")
    @*@Html.JavaScript("lib/utility/ext.js")*@
    @Html.JavaScript("lib/counter/orgTree.js")
    <style type="text/css">
        body {
            min-width: 100px;
        }
        table tbody tr { height: 30px; }
    </style>
    <script lang="javascript">
        $(function() {

            $("#HallNo").on("change", onSelect);

            //选择
            function onSelect() {
                var id = $(this).val();
                //if (id && id.length>0) {
                //获取窗口
                $.ajax({
                    cache: false,
                    type: 'GET',
                    dataType: 'json',
                    url: '@Url.Action("GetTabs")?hallNo=' + id + "&_=" + (new Date()).getTime(),
                    success: function(data) {
                        var $conter = $("#CounterId");
                        var list = $("option:gt(0)", $conter).length;
                        $("option:gt(0)", $conter).remove();

                        if (data && data.length > 0) {
                            $.each(data, function(i, item) {
                                $conter.append("<option value='" + item.Value + "'>" + item.Text + "</option>");
                            });
                        }
                    }
                });

                //获取员工信息
                $.ajax({
                    cache: false,
                    type: 'GET',
                    dataType: 'json',
                    url: '@Url.Action("GetStaffs")?hallNo=' + id + "&_=" + (new Date()).getTime(),
                    success: function(data) {
                        //W1A_STAFF_NAME
                        for (var i = 1; i <= 7; i++) {
                            //
                            var $selectA = $("#W" + i + "A_STAFF_NAME");
                            $("option:gt(0)", $selectA).remove();

                            var $selectP = $("#W" + i + "P_STAFF_NAME");
                            $("option:gt(0)", $selectP).remove();

                            if (data && data.length > 0) {
                                $.each(data, function(n, item) {
                                    $selectA.append("<option value='" + item.Value + "'>" + item.Text + "</option>");

                                    $selectP.append("<option value='" + item.Value + "'>" + item.Text + "</option>");
                                });
                            }
                        }
                    }
                });
                //}
            };

            $("select[dType='select']").on("change", function() {
                var that = $(this);
                var $hidObj = $("#" + that.attr("hidId"));
                $hidObj.val(that.val());
            });


        });
    </script>
}