@using gzsw.util
@using gzsw.web
@model IList<gzsw.model.dto.Statistics_DAYQUEUETJ>
@{
    ViewBag.Title = "STAT_DAYQUEUETJ";
    Layout = "~/Views/Shared/_MainLayout.cshtml";
    var index = 0;
    // 统计量总数
    double valueCount = Model.Select(
        x => x.STAFF_QDDTJ_TICKETNUM + x.STAFF_QDDTJ_RLL + x.STAFF_QDDTJ_QHNUM).Sum();
    // 呼叫量
    var value1 = (Model.Select(x => x.STAFF_QDDTJ_TICKETNUM).Sum());
    // 办理量
    var value2 = (Model.Select(x => x.STAFF_QDDTJ_RLL).Sum());
    // 弃号量
    var value3 = (Model.Select(x => x.STAFF_QDDTJ_QHNUM).Sum());
}
@section Head{
    @Html.JavaScript("lib/datepicker/WdatePicker.js")
    @Html.StyleSheet("lib/ztree/zTreeStyle.css")
    @Html.JavaScript("lib/ztree/jquery.ztree.core-3.5.min.js")
    @Html.JavaScript("lib/ztree/jquery.ztree.excheck-3.5.min.js")
    @Html.JavaScript("lib/counter/orgTree.js")
    <!--  图表插件 -->
    @Html.JavaScript("lib/highcharts/js/highcharts.js")
    @Html.JavaScript("lib/highcharts/js/modules/exporting.src.js")
    @Html.JavaScript("lib/highcharts/js/highcharts-3d.js")
   <!-- 图表排序脚本 --> 
    @Html.JavaScript("lib/tablesorter/js/jquery.tablesorter.js")
    @Html.JavaScript("lib/tablesorter/js/jquery.tablesorter.widgets.min.js") 
      <!-- 图表排序 -->
@Html.JavaScript("lib/tablesorter/js/jquery.tablesorter.pager.js")
    <style type="text/css">
        .ztree{z-index:9999;}
    </style>
    <script type="text/javascript">
        $(function () {
            // 表格数据排序 
            $("#datatable").tablesorter()
                    .tablesorterPager({container: $("#pager")}); 
            //初始化树
            orgTree.init({
                documentId: "txtORG_NAM", 
                loadDataUrl: '@Url.Action("GetHallTree", "VirtualHall", new {area = "SYS"})',
                onSelect: onSelect
            });

            // 组织结构选择
            function onSelect(treeId, treeNode) { 
                if (treeNode != undefined) {
                    $("#txtORG_NAM").val(treeNode.name);
                    $("#hdORG_NAM").val(treeNode.id);
                } 
            }
            // 查询
            $("#btnSearch").click(function () { 
                var url = location.href;                 url =  url.getUrl({
                    _t: Date.parse(new Date()),
                    txtBeginTime: $("#txtBeginTime").val(),
                    txtEndTime: $("#txtEndTime").val(),
                    hdORG_NAM: $("#hdORG_NAM").val(),
                    txtORG_NAM:$("#txtORG_NAM").val()
                });                location.href = url; 
            });
            // 根据Table 生成图表
            $(function () {
                var saturationOption = {
                    chart: {
                        type: 'column',
                        renderTo: 'saturationContent',
                        options3d: {
                            enabled: true,
                            alpha: 0,
                            beta:0,
                            depth: 12,
                            viewDistance: 25
                        }
                      /*  ,margin: [50, 50, 100, 80]*/
                    },
                    title: { text: '个人业务量分布图   <br/><span style=\"font-size:12px;\">(@(ViewData["organizeName"]))</span>' },
                    xAxis: {
                        categories:  @Html.Raw(ViewData["x"]) 
                    },
                    yAxis: {
                        min: 0,
                        title: {
                            text: '业务量'
                        }
                        /*  ,
                           allowDecimals: true */
                    },
                    tooltip: {
                        headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
                        pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                            '<td style="padding:0"><b>{point.y} </b></td></tr>',
                        footerFormat: '</table>', 
                        shared: true,
                        useHTML: true
                    },
                    legend: {
                        enabled: false
                    }, 
                    series: [
                     { 
                          name: '呼叫量',
                          data: @Html.Raw(ViewData["y1"]),
                              color: "#52ab46"
                          },
                          { 
                              name: '办理量',
                              data: @Html.Raw(ViewData["y2"]),
                              color: "#ccd451"
                              },
                          { 
                              name: '弃号量',
                              data: @Html.Raw(ViewData["y3"]),
                              color: "#ff9e9e"
                          }
                    ]
                };
                var saturationChart =  new Highcharts.Chart(saturationOption);

            });
        });
    </script>
}
 
<!-- 查询条件 -->
<div class="l-panel-search">
    <table class="tabSearchList">
        <tbody>
            <tr>
                <td style="width:85px;">开始时间：</td>
                <td style="width:170px;"><input type="text" readonly="readonly" onclick="WdatePicker()" value="@(ViewData["beginTime"])" name="txtBeginTime" id="txtBeginTime"></td>
                <td style="width: 85px;"> 结束时间：</td>
                <td style="width:170px;"><input type="text" readonly="readonly" onclick="WdatePicker()" value="@(ViewData["txtEndTime"])" name="txtEndTime" id="txtEndTime"></td>
                <td style="width: 100px;"> 组织机构名称：</td>
                <td style="width:170px;">
                    <input type="text" name="txtORG_NAM" value="@(ViewData["organizeName"])" readonly="readonly" id="txtORG_NAM">
                    <div id="orgTreeContent" style="display: none; position: absolute; background-color: #FFF; border: 1px solid #ccc;">
                        <ul id="treeOrg" class="ztree" style="clear:both;"></ul>
                    </div>
                    <input type="hidden" value="@(ViewData["organizeId"])" id="hdORG_NAM" name="hdORG_NAM" />
                </td>
                <td>
                    <div id="btnSearch" class="l-button l-button-hasicon" ligeruiid="btnSearch" style="width: 60px; margin-left: 10px;">
                        <div class="l-button-l"></div>
                        <div class="l-button-r"></div>
                        <span> 查 询 </span>
                        <img src="/Content/lib/ligerUI/skins/icons/search.png">
                    </div>
                </td>
            </tr>

        </tbody>
    </table>
</div>
<!-- 内容 -->
<div class="tablePanel" style="padding-top:5px;">
    <table id="datatable" class="tablelist tablesorter tablesorter-default" cellpadding="0" cellspacing="0">
        <thead>
            <tr>
                <th style="text-align: center; background-image: none;  " colspan="2">  </th>
                <th style="text-align: center; background-image: none;  " colspan="2"> 呼叫  </th>
                <th style="text-align: center; background-image: none;  " colspan="2"> 办理 </th>
                <th style="text-align: center; background-image: none;  " colspan="2"> 弃号 </th>
            </tr>
            <tr>
                <th style="background-image: none; " >序号</th>
                <th style="background-image: none; ">员工名称</th>
                <th style="background-image: none; ">呼叫量</th>
                <th style="background-image: none; ">呼叫量占比</th>
                <th style="background-image: none; ">办理量</th>
                <th style="background-image: none; ">办理量占比</th>
                <th style="background-image: none; ">弃号量</th>
                <th style="background-image: none; ">弃号量占比</th>
            </tr>
        </thead>
        @if (Model != null && Model.Count() > 0)
        {
            foreach (var item in Model)
            {
                <tr>
                    <td>@(++index)</td>
                    <td>@item.STAFF_NAM</td>
                    <td>@item.STAFF_QDDTJ_TICKETNUM</td>
                    <td>@item.DoAllBFB %</td>
                    <td>@item.STAFF_QDDTJ_RLL</td>
                    <td>@item.NoDoBFB %</td>
                    <td>@item.STAFF_QDDTJ_QHNUM</td>
                    <td>@item.NoDoCountBFB %</td>
                </tr>
            }

            <tfoot>
                <tr>
                    <td colspan="2" style="text-align: center; font-weight: bold; font-size: 14px;">合计</td>
                    <td>@value1</td>
                    <td>@((value1 / valueCount).ToPercent())</td>
                    <td>@value2</td>
                    <td>@((value2 / valueCount).ToPercent())</td>
                    <td>@value3</td>
                    <td>@((value3 / valueCount).ToPercent())</td>
                </tr>
            </tfoot>
        }

    </table>

    @if (Model == null || Model.Count <= 0)
    {
        <div class="l-panel-notDATA">
            暂无数据
        </div>
    }
    else
    {
            <div id="pager" class="l-panel-bar">
        <div class="l-panel-bbar-inner">
            <div class="l-bar-group  l-bar-message">
                @*<span class="l-bar-text">当前第1页/共1页 (共:18条记录/每页显示:20)</span>*@
            </div><div class="l-bar-group">
                <select class="pagesize">
                    <option selected="selected" value="10">10</option>
                    <option value="30">30</option>
                    <option value="40">40</option>
                    <option value="50">50</option>
                </select>
            </div>
            <div class="l-bar-separator"></div>
            <div class="l-bar-group">
                <div class="l-bar-button l-bar-btnfirst">
                    <span title="首页" class="first"></span>
                </div>
                <div class="l-bar-button l-bar-btnprev">
                    <span title="上一页" class="prev"></span>
                </div>
            </div>
            <div class="l-bar-separator"></div>
             <div class="l-bar-group">
            <span class="pcontrol">
                <input type="text" style="width:30px;height:14px;" readonly="readonly" class="pagedisplay" /> 
            </span>
                </div>  
            <div class="l-bar-separator"></div>
            <div class="l-bar-group">
                <div class="l-bar-button l-bar-btnnext">
                    <span class="next" title="下一页"></span>
                </div>
                <div class="l-bar-button l-bar-btnlast">
                    <span class="last" title="尾页"></span>
                </div>
            </div> 
        </div> 
 </div>

    }
</div>
<div id="saturationContent" style="padding-top:25px;"></div>